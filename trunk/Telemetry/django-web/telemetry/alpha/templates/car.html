{% extends "base.html" %}
{% load humanize %}

{% block title %}{{car.name}}{% endblock title %}

{% block head %}
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script>
function update() {
  $.getJSON('/api/car/{{car.pk}}', function(data){
    $("#speed").html(data.speed);
    $("#last_updated").html(data.time);
    if (data.connected) {
      $("#last_updated").removeClass('red');
    } else {
      $("#last_updated").addClass('red');
    }
    map.setCenter(new google.maps.LatLng(data.lat, data.lng));
  });
}

$(document).ready(function(){
  setInterval(update, 1000);
});

function initialize() {
  var myOptions = {
    zoom: 4,
    center: new google.maps.LatLng({{data_packets.0.lat}}, {{data_packets.0.lng}}),
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };

  var map = new google.maps.Map(document.getElementById('map_canvas'),
      myOptions);

  var marker = new google.maps.Marker({
    position: map.getCenter(),
    map: map,
    title: 'Click to zoom'
  });
}

google.maps.event.addDomListener(window, 'load', initialize);
</script>
<style>
.red {
  color: red;
}
</style>
{% endblock head %}

{% block container %}
<div class="hero-unit">
  <h1 class="pull-right">
    <span id="speed">
      {% if not data_packets.0.speed %}
        0
      {% else %}
        {{data_packets.1.speed}}
      {% endif %}
    </span>
    <small>mph</small>
  </h1>
  <h1>{{car.name}}</h1>
  <p id="last_updated">
    {% if data_packets.0 %}
      Last updated {{data_packets.0.time|naturaltime}}
    {% else %}
      Not connected
    {% endif %}
  </p>
</div>
<div class="row">
  <div class="span8 offset 2">
    <div id="map_canvas"></div>
  </div>
</div>
{% endblock container %}